//目前的提示框中数据量能显示，但是源端口和目的端口无法正确显示。
<html>    
  <head>    
        <meta charset="utf-8">    
        <title>Pie</title>    
  </head>   
  
<style>  
  .tooltip{
	 font-family: simsun;
	 font-size: 14px;
	 width: 120;
	 height: auto;
	 position: absolute;
	 text-align: center;
     border-style: solid; 
	 border-width: 1px;
	 background-color: white;
	 border-radius: 5px;
  }
  
</style>  
    <body>    
        <script src="d3.js" charset="utf-8"></script>    
        <script>  
          
        var width =710;  
        var height = 710;   
        
        var source=[];
				var target=[];
				
        d3.csv("flow.csv",function(error,dataset){
                console.log(dataset);
                for(var i = 0; i < dataset.length; i++){
                	source.push(dataset[i].source);
                	target.push(dataset[i].target);
                }

        var svg = d3.select("body").append("svg")  
                                .attr("width",width+800)  
                                .attr("height",height);  

        var pie = d3.layout.pie()
                           .value(function(d){
                            return d.flow;
                           });
				
          
        var outerRadius = width / 2;  
        var innerRadius = width / 2.1;  
        var arc = d3.svg.arc()  
                        .innerRadius(innerRadius)  
                        .outerRadius(outerRadius);  
          
        var color = d3.scale.category20c();  
          
        var arcs = svg.selectAll("g")  
                      .data(pie(dataset))  
                      .enter()  
                      .append("g")
                      .attr("transform","translate("+(100+outerRadius)+","+outerRadius+")");  
                        
        arcs.append("path")  
            .attr("fill",function(d,i){  
                return color(i);  
            })  
            .attr("d",function(d){  
                return arc(d);  
            });
            
        var tooltip = d3.select("body")
									.append("div")
									.attr("class","tooltip")
									.style("opacity",0.0);
				
				arcs.on("mouseover",function(d){

				///就是这一行
				tooltip.html("源端口：" + Number(source) + "<br />" + "目的端口：" + d3.sum(dataset,function(d){return d.target;}) + "<br />" + "数据量：" + Number(d.value))
					.style("left", (d3.event.pageX) + "px")
					.style("top", (d3.event.pageY + 20) + "px")
					.style("opacity",1.0);
				})
				.on("mousemove",function(d){
					tooltip.style("left", (d3.event.pageX) + "px")
							.style("top", (d3.event.pageY + 20) + "px");
				})
				.on("mouseout",function(d){
				    tooltip.style("opacity",0.0); 
				});

        /*console.log(dataset);  
        console.log(pie(dataset));  */
         })
            
        </script>    
          
    </body>    
</html>   
